---
import Lightbox from './Lightbox.astro';

interface Image {
  src: string;
  alt: string;
  description?: string;
}

interface Step {
  number: number;
  title: string;
  description: string;
  image?: string;
  alt?: string;
  images?: Image[];
}

interface Props {
  title: string;
  steps: Step[];
}

const { title, steps } = Astro.props;
---

<div class="assembly-guide">
  <div class="wrapper stack gap-8">
    <header class="section-header stack gap-2 lg:gap-4">
      <h2>{title}</h2>
      <p>Instructions d√©taill√©es pour assembler votre lunette E.R.T</p>
    </header>
    
    <div class="steps-container">
      {steps.map((step) => (
        <div class="step-card">
          <div class="step-number">
            <span>{step.number}</span>
          </div>
          <div class="step-content">
            <div class="step-text">
              {step.title && <h3>{step.title}</h3>}
              <p set:html={step.description}></p>
            </div>
            <div class="step-image">
              {step.images ? (
                <div class="images-grid">
                  {step.images.map((img) => (
                    <div class="image-with-text">
                      {img.description && <p class="image-description">{img.description}</p>}
                      <img 
                        src={img.src} 
                        alt={img.alt} 
                        loading="lazy" 
                        class="lightbox-trigger"
                        data-src={img.src}
                        data-alt={img.alt}
                      />
                    </div>
                  ))}
                </div>
              ) : step.image && (
                <img 
                  src={step.image} 
                  alt={step.alt} 
                  loading="lazy" 
                  class="lightbox-trigger"
                  data-src={step.image}
                  data-alt={step.alt}
                />
              )}
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</div>

<Lightbox />

<style>
  .assembly-guide {
    position: relative;
    padding: 5rem var(--grid-gutter);
    background: var(--gray-999);
    margin-bottom: 3rem;
  }

  .assembly-guide::before {
    --hero-bg: var(--bg-image-subtle-1);
    content: '';
    position: absolute;
    pointer-events: none;
    left: 50%;
    width: 100vw;
    aspect-ratio: calc(2.25 / var(--bg-scale));
    top: 0;
    transform: translateY(-75%) translateX(-50%);
    background:
      url('/assets/backgrounds/noise.png') top center/220px repeat,
      var(--hero-bg) center center / var(--bg-gradient-size) no-repeat,
      var(--gray-999);
    background-blend-mode: overlay, normal, normal, normal;
    mix-blend-mode: var(--bg-blend-mode);
    z-index: -1;
  }

  .section-header {
    text-align: center;
    max-width: 50ch;
    margin: 0 auto;
    color: var(--gray-300);
  }

  .section-header h2 {
    font-size: var(--text-2xl);
    color: var(--gray-0);
    margin-bottom: 0.5rem;
  }

  .steps-container {
    display: flex;
    flex-direction: column;
    gap: 3rem;
    max-width: 60rem;
    margin: 0 auto;
  }

  .step-card {
    background: var(--gray-800);
    border: 1px solid var(--gray-700);
    border-radius: 1.5rem;
    overflow: hidden;
    box-shadow: var(--shadow-md);
  }

  .step-number {
    background: var(--gray-700);
    color: black;
    padding: 1rem;
    text-align: center;
    font-weight: 700;
    font-size: var(--text-lg);
  }

  .step-content {
    display: grid;
    gap: 2rem;
    padding: 2rem;
    align-items: center;
  }

  .step-text h3 {
    font-size: var(--text-xl);
    color: var(--gray-0);
    margin-bottom: 1rem;
  }

  .step-text p {
    color: var(--gray-300);
    line-height: 1.6;
    font-size: var(--text-md);
  }

  .step-image {
    border-radius: 1rem;
    overflow: hidden;
    box-shadow: var(--shadow-sm);
  }

  .step-image img {
    width: 100%;
    height: auto;
    display: block;
    cursor: pointer;
    transition: transform 0.2s ease, opacity 0.2s ease;
  }

  .step-image img:hover {
    transform: scale(1.02);
    opacity: 0.9;
  }

  .step-image img.lightbox-trigger {
    position: relative;
  }

  .step-image img.lightbox-trigger::after {
    content: 'üîç';
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 0.5rem;
    border-radius: 50%;
    font-size: 0.875rem;
    opacity: 0;
    transition: opacity 0.2s ease;
  }

  .step-image:hover img.lightbox-trigger::after {
    opacity: 1;
  }

  .images-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
  }

  .image-with-text {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    align-items: center;
  }

  .image-description {
    color: var(--gray-300);
    line-height: 1.6;
    font-size: var(--text-md);
    margin: 0;
    text-align: left;
  }

  .image-with-text img {
    width: 100%;
    height: auto;
    display: block;
    cursor: pointer;
    transition: transform 0.2s ease, opacity 0.2s ease;
    border-radius: 1rem;
  }

  .image-with-text img:hover {
    transform: scale(1.02);
    opacity: 0.9;
  }

  @media (max-width: 50em) {
    .image-with-text {
      grid-template-columns: 1fr;
      gap: 1rem;
    }
  }

  @media (min-width: 50em) {
    .assembly-guide {
      padding: 7rem var(--grid-gutter);
    }

    .section-header h2 {
      font-size: var(--text-4xl);
    }

    .step-content {
      grid-template-columns: 1fr 1fr;
      gap: 3rem;
    }

    .step-text {
      order: 1;
    }

    .step-image {
      order: 2;
    }

    /* Alterner l'ordre pour les √©tapes paires */
    .step-card:nth-child(even) .step-text {
      order: 2;
    }

    .step-card:nth-child(even) .step-image {
      order: 1;
    }
  }

  @media (min-width: 75em) {
    .step-content {
      padding: 3rem;
    }
  }
</style>
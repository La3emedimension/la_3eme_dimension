---
import { getCollection, render } from "astro:content";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Icon from "../../../components/Icon.astro";
import { localePath, type Locale } from '../../../i18n';
import { getSlugWithoutLocale } from '../../../lib/collections';

const locale: Locale = 'en';

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog");
  return blogEntries
    .filter(entry => entry.id.startsWith('en/'))
    .map((entry) => ({
      params: { slug: entry.id.replace('en/', '').replace(/\.md$/, '') },
      props: { entry },
    }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

const formatDate = (date: Date) => {
  return date.toLocaleDateString("en-GB", {
    year: "numeric",
    month: "long",
    day: "numeric"
  });
};
---

<BaseLayout
  locale={locale}
  title={entry.data.title}
  description={`Blog article: ${entry.data.title}`}
  keywords={`blog, 3d printing, ${entry.data.title.toLowerCase()}`}
  ogImage={entry.data.img ? `https://la3emedim.fr${entry.data.img}` : "https://la3emedim.fr/assets/preview.png"}
>
  <div class="stack gap-20 lg:gap-48">
    <div class="wrapper">
      <header class="blog-header">
        <nav class="breadcrumb">
          <a href={localePath('/blog/', locale)}>
            <Icon icon="arrow-left" size="1em" />
            Back to blog
          </a>
        </nav>

        <div class="article-meta">
          <time datetime={entry.data.publishDate.toISOString()}>
            {formatDate(entry.data.publishDate)}
          </time>
          <h1>{entry.data.title}</h1>
        </div>

        {entry.data.img && (
          <img src={entry.data.img} alt={entry.data.title} class="hero-image" loading="eager" decoding="async" />
        )}
      </header>

      <main class="blog-content">
        <Content />
      </main>

      <footer class="blog-footer">
        <nav class="back-to-blog">
          <a href={localePath('/blog/', locale)}>
            <Icon icon="arrow-left" size="1em" />
            View all articles
          </a>
        </nav>
      </footer>
    </div>
  </div>
</BaseLayout>

<style>
  .blog-header { margin-bottom: 3rem; }
  .breadcrumb { margin-bottom: 2rem; }
  .breadcrumb a { display: inline-flex; align-items: center; gap: 0.5rem; color: var(--accent-regular); text-decoration: none; font-size: var(--text-sm); font-weight: 500; }
  .article-meta { text-align: center; margin-bottom: 2rem; }
  .article-meta time { display: block; font-size: var(--text-sm); color: var(--gray-400); text-transform: uppercase; margin-bottom: 1rem; }
  .article-meta h1 { font-size: var(--text-4xl); font-weight: 700; background: var(--gradient-accent); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 0; }
  .hero-image { width: 100%; max-height: 400px; object-fit: cover; border-radius: 1rem; box-shadow: var(--shadow-md); }
  .blog-content { max-width: 65ch; margin: 0 auto; line-height: 1.7; }
  .blog-content :global(h2) { font-size: var(--text-2xl); font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; color: var(--gray-100); }
  .blog-content :global(p) { margin-bottom: 1.5rem; color: var(--gray-300); }
  .blog-content :global(img) { width: 100%; height: auto; border-radius: 0.5rem; margin: 2rem 0; box-shadow: var(--shadow-sm); }
  .blog-footer { margin-top: 4rem; padding-top: 2rem; border-top: 1px solid var(--gray-800); text-align: center; }
  .back-to-blog a { display: inline-flex; align-items: center; gap: 0.5rem; color: var(--accent-regular); text-decoration: none; font-weight: 500; padding: 0.75rem 1.5rem; border: 1px solid var(--accent-regular); border-radius: 2rem; }
</style>

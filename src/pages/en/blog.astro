---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Icon from "../../components/Icon.astro";
import { useTranslations, localePath, type Locale } from '../../i18n';
import { getLocalizedCollection, getSlugWithoutLocale } from '../../lib/collections';

const locale: Locale = 'en';
const t = useTranslations(locale);

const blogPosts = await getLocalizedCollection('blog', locale);
const filteredPosts = blogPosts.filter(({ data }) => data.draft !== true);
const sortedPosts = filteredPosts.sort((a, b) =>
  b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
);

const formatDate = (date: Date) => {
  return date.toLocaleDateString("en-GB", {
    year: "numeric",
    month: "long",
    day: "numeric"
  });
};
---

<BaseLayout
  locale={locale}
  title="Blog - La 3ème dimension"
  description="Articles and news from La 3ème dimension"
  keywords="3d printing blog, telescope news, 3d innovations"
>
  <div class="stack gap-20 lg:gap-48">
    <div class="wrapper stack gap-8 lg:gap-20">
      <header class="hero">
        <h1>{t.blog.title}</h1>
        <p>{t.blog.tagline}</p>
      </header>

      <main class="blog-grid">
        {sortedPosts.length === 0 ? (
          <p class="no-posts">No articles yet. Check back soon!</p>
        ) : (
          sortedPosts.map((post) => {
            const postSlug = getSlugWithoutLocale(post.id, locale);
            return (
            <article class="blog-card">
              <a href={localePath(`/blog/${postSlug}/`, locale)}>
                {post.data.img && (
                  <div class="image-container">
                    <img src={post.data.img} alt={post.data.img_alt || post.data.title} loading="lazy" decoding="async" />
                    <div class="image-overlay">
                      <h2 class="overlay-title">{post.data.title}</h2>
                    </div>
                  </div>
                )}
                <div class="content">
                  <div class="content-row">
                    <time datetime={post.data.publishDate.toISOString()}>
                      {formatDate(post.data.publishDate)}
                    </time>
                    <span class="read-more">
                      Read article <Icon icon="arrow-right" size="1em" />
                    </span>
                  </div>
                </div>
              </a>
            </article>
          );})
        )}
      </main>
    </div>
  </div>
</BaseLayout>

<style>
  .hero { text-align: center; padding: 2rem 0; }
  .hero h1 { font-size: var(--text-4xl); font-weight: 700; margin-bottom: 0.5rem; background: var(--gradient-accent); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
  .hero p { font-size: var(--text-lg); color: var(--gray-400); }
  .blog-grid { display: grid; gap: 2rem; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
  .blog-card { border-radius: 1rem; overflow: hidden; background: var(--gradient-subtle); border: 1px solid var(--gray-800); transition: all var(--theme-transition); height: 140px; }
  .blog-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); border-color: var(--accent-regular); }
  .blog-card a { text-decoration: none; color: inherit; display: flex; flex-direction: column; height: 100%; }
  .image-container { position: relative; overflow: hidden; }
  .blog-card img { width: 100%; height: 90px; object-fit: cover; transition: transform var(--theme-transition); }
  .image-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, rgba(138, 43, 226, 0.6) 0%, rgba(0, 0, 0, 0.8) 100%); display: flex; align-items: flex-end; padding: 1.5rem; }
  .overlay-title { color: white; font-size: var(--text-lg); font-weight: 600; margin: 0; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8); line-height: 1.3; }
  .content { padding: 0.75rem; flex: 1; display: flex; align-items: center; }
  .content-row { display: flex; justify-content: space-between; align-items: center; width: 100%; }
  .content time { font-size: var(--text-sm); color: var(--gray-400); text-transform: uppercase; font-weight: 500; }
  .read-more { display: inline-flex; align-items: center; gap: 0.5rem; font-size: var(--text-sm); color: var(--accent-regular); font-weight: 500; }
  .no-posts { text-align: center; padding: 4rem 2rem; font-size: var(--text-lg); color: var(--gray-400); grid-column: 1 / -1; }
</style>

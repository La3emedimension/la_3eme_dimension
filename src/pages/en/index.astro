---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Grid from "../../components/Grid.astro";
import Hero from "../../components/Hero.astro";
import Icon from "../../components/Icon.astro";
import PortfolioPreview from "../../components/PortfolioPreview.astro";
import ScrollIndicator from "../../components/ScrollIndicator.astro";
import ContactCTA from "../../components/ContactCTA.astro";
import Skills from "../../components/Skills.astro";
import ProductCarousel from "../../components/ProductCarousel.astro";
import { useTranslations, localePath, type Locale } from '../../i18n';
import { getLocalizedCollection, getLocalizedDataCollection, getSlugWithoutLocale } from '../../lib/collections';

const locale: Locale = 'en';
const t = useTranslations(locale);

const allProducts = await getLocalizedDataCollection('products', locale);
const smallestProduct = allProducts.find((p) => getSlugWithoutLocale(p.id, locale) === 'smallest');
const ertProduct = allProducts.find((p) => getSlugWithoutLocale(p.id, locale) === 'ert');

const businessStructuredData = {
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    name: "La 3ème dimension",
    description: "3D printing specialist and compact telescope design. Innovation in portable astronomy with the Smallest telescope.",
    url: "https://la3emedim.fr/en",
    telephone: "0760853870",
    email: "la3emedim@gmail.com",
    address: {
        "@type": "PostalAddress",
        addressLocality: "Toulouse",
        addressRegion: "Occitanie",
        addressCountry: "FR",
    },
};
---

<BaseLayout
    locale={locale}
    title="La 3ème dimension - 3D Printing & Astronomical Telescopes"
    description="3D printing specialist and compact telescope design. Discover the Smallest, a practical portable telescope for nomadic astronomy."
    keywords="3d printing, portable telescope, smallest telescope, nomadic astronomy, 3d design"
    structuredData={businessStructuredData}
>
    <div class="stack gap-20 lg:gap-36">
        <div class="wrapper stack gap-20 lg:gap-36">
            <header class="hero homepage-hero">
                <Hero
                    align="start"
                >
                    <p class="service-description">Design of 3D printed astronomical<br>instruments and accessories</p>
                    <div class="roles">
                        <a href="mailto:la3emedim@gmail.com" class="contact-link">
                            {t.contact.cta} <Icon icon="pencil-line" size="1.33em" />
                        </a>
                        <a href="tel:0760853870" class="phone-link">
                            07 60 85 38 70
                            <Icon icon="phone" size="1.2em" />
                        </a>
                    </div>
                </Hero>

                <ProductCarousel locale={locale} />
            </header>

            <Skills locale={locale} />
        </div>

        {(smallestProduct || ertProduct) && (
            <main class="wrapper section with-background bg-variant">
                <div class="section-header stack gap-2 lg:gap-4">
                    <h5>Discover our products</h5>
                </div>
                <div class="products-grid">
                    {smallestProduct && (
                        <a class="card featured product-card" href={localePath('/product/smallest/', locale)}>
                            <span class="title">{smallestProduct.data.sections[0].data.title}</span>
                            <img
                                src={smallestProduct.data.sections[0].data.heroImage.src}
                                alt={smallestProduct.data.sections[0].data.heroImage.alt}
                                loading="lazy"
                                decoding="async"
                            />
                            <div class="featured-description">{smallestProduct.data.sections[0].data.tagline}</div>
                        </a>
                    )}
                    {ertProduct && (
                        <a class="card featured product-card" href={localePath('/product/ert/', locale)}>
                            <span class="title">{ertProduct.data.sections[0].data.title}</span>
                            <img
                                src={ertProduct.data.sections[0].data.heroImage.src}
                                alt={ertProduct.data.sections[0].data.heroImage.alt}
                                loading="lazy"
                                decoding="async"
                            />
                            <div class="featured-description">{ertProduct.data.sections[0].data.tagline}</div>
                        </a>
                    )}
                </div>
            </main>
        )}

        <div id="contact-section">
            <ContactCTA locale={locale} />
        </div>
    </div>

    <ScrollIndicator />
</BaseLayout>

<style>
    a { text-decoration: none; }
    .contact-link, .phone-link {
        cursor: pointer;
        display: flex;
        text-align: center;
        align-items: center;
        padding: 0.5rem 1rem;
        gap: 0.5rem;
        color: var(--accent-text-over);
        border: 1px solid var(--accent-regular);
        background-color: var(--accent-regular);
        border-radius: 999rem;
        font-size: var(--text-md);
        line-height: 1.35;
        white-space: nowrap;
        text-decoration: none;
        transition: all 0.3s ease;
    }
    .contact-link:hover, .phone-link:hover {
        background-color: var(--accent-dark);
        transform: translateY(-1px);
        box-shadow: var(--shadow-md);
    }
    .hero {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        gap: 2rem;
        width: 100%;
    }
    .hero :global(.hero-content) {
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    .custom-tagline {
        font-size: var(--text-md);
        font-weight: 600;
        color: var(--accent-regular);
        margin: -1.2rem 0 0.1rem 0;
        max-width: fit-content;
    }
    .service-description {
        font-size: var(--text-lg);
        color: var(--gray-300);
        margin: 0 0 0.75rem 0;
        max-width: 57ch;
        line-height: 1.5;
    }
    .roles {
        margin-top: 0.5rem;
        display: flex;
        gap: 0.5rem;
        justify-content: flex-start;
        width: 100%;
        flex-wrap: wrap;
    }
    .hero :global(.product-carousel) {
        width: 100%;
        max-width: 100%;
        aspect-ratio: 16 / 9;
        border-radius: 1.5rem;
        box-shadow: var(--shadow-md);
    }
    @media (min-width: 50em) {
        .hero {
            max-width: none;
            display: grid;
            grid-template-columns: 5fr 4fr;
            padding-inline: 2.5rem;
            gap: 3.75rem;
            align-items: center;
        }
        .hero :global(.hero-content) {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .custom-tagline {
            font-size: var(--text-lg);
        }
        .service-description {
            font-size: var(--text-2xl);
        }
        .hero :global(.product-carousel) {
            aspect-ratio: 4 / 3;
            border-radius: 1rem;
        }
    }
    .philosophy-text {
        text-align: center;
        max-width: 80ch;
        margin: 4rem auto 0 auto;
        padding: 0;
    }
    .products-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
        width: 100%;
    }
    @media (min-width: 50em) {
        .products-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 2rem;
            grid-area: gallery;
        }
    }
    .product-card {
        width: 100%;
    }
    .section { display: grid; gap: 2rem; }
    .with-background { position: relative; }
    .with-background::before {
        --hero-bg: var(--bg-image-subtle-2);
        content: "";
        position: absolute;
        pointer-events: none;
        left: 50%;
        width: 100vw;
        aspect-ratio: calc(2.25 / var(--bg-scale));
        top: 0;
        transform: translateY(-75%) translateX(-50%);
        background:
            url("/assets/backgrounds/noise.png") top center/220px repeat,
            var(--hero-bg) center center / var(--bg-gradient-size) no-repeat,
            var(--gray-999);
        background-blend-mode: overlay, normal, normal, normal;
        mix-blend-mode: var(--bg-blend-mode);
        z-index: -1;
    }
    .with-background.bg-variant::before { --hero-bg: var(--bg-image-subtle-1); }
    .section-header {
        justify-self: center;
        text-align: center;
        max-width: 50ch;
        font-size: var(--text-md);
        color: var(--gray-300);
    }
    .section-header h3 { font-size: var(--text-2xl); }
    @media (min-width: 50em) {
        .section {
            grid-template-columns: repeat(4, 1fr);
            grid-template-areas: "header header header header" "gallery gallery gallery gallery";
            gap: 5rem;
        }
        .section-header { grid-area: header; font-size: var(--text-lg); }
        .section-header h3 { font-size: var(--text-4xl); }
        .gallery { grid-area: gallery; }
    }
    .card {
        display: grid;
        grid-template: auto 1fr / auto 1fr;
        height: 11rem;
        background: var(--gradient-subtle);
        border: 1px solid var(--gray-800);
        border-radius: 0.75rem;
        overflow: hidden;
        box-shadow: var(--shadow-sm);
        text-decoration: none;
        font-family: var(--font-brand);
        font-size: var(--text-lg);
        font-weight: 500;
        transition: box-shadow var(--theme-transition);
        filter: grayscale(100%);
    }
    .card:hover { box-shadow: var(--shadow-md); filter: grayscale(0%); }
    .card .title {
        grid-area: 1 / 1 / 2 / 2;
        z-index: 1;
        margin: 0.5rem;
        padding: 0.5rem 1rem;
        background: var(--gray-999);
        color: var(--gray-200);
        border-radius: 0.375rem;
    }
    .card img { grid-area: 1 / 1 / 3 / 3; width: 100%; height: 100%; object-fit: cover; }
    .card.featured {
        height: 28rem;
        min-height: 28rem;
        transform: scale(1.02);
        transition: all var(--theme-transition);
    }
    .card.featured:hover { transform: scale(1.05); box-shadow: var(--shadow-xl); }
    .card.featured .title {
        font-size: var(--text-xl);
        font-weight: 600;
        background: var(--accent-regular);
        color: var(--accent-text-over);
    }
    .featured-description {
        grid-area: 2 / 1 / 3 / 3;
        z-index: 2;
        margin: 1rem;
        padding: 1rem;
        background: transparent;
        color: white;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
        border-radius: 0.5rem;
        font-size: var(--text-base);
        line-height: 1.4;
        font-style: italic;
        text-align: center;
        font-weight: 500;
        align-self: end;
    }
    @media (min-width: 50em) {
        .card { height: 22rem; border-radius: 1.5rem; }
        .card.featured { height: 32rem; min-height: 32rem; }
        .card .title { border-radius: 0.9375rem; }
        .card.featured .title { font-size: var(--text-2xl); }
        .featured-description {
            font-size: var(--text-lg);
            margin: 1.5rem;
            padding: 1.5rem;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.9);
        }
    }
</style>
